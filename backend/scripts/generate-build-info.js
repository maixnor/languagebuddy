const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

const packageJsonPath = path.join(__dirname, '../package.json');
const packageJson = require(packageJsonPath);
const version = packageJson.version;

let commitHash = 'unknown';
try {
    // Explicitly set cwd to the root of the git repository (two levels up from this script)
    commitHash = execSync('git rev-parse --short HEAD', { cwd: path.join(__dirname, '../../') }).toString().trim();
} catch (e) {
    console.warn('Could not determine commit hash.', e);
}

const content = `// This file is auto-generated by scripts/generate-build-info.js
// Do not edit manually.

export const COMMIT_HASH = '${commitHash}';
export const PACKAGE_VERSION = '${version}';
`;

const outputPath = path.join(__dirname, '../src/build-info.ts');
fs.writeFileSync(outputPath, content);
console.log(`Generated ${outputPath} with version ${version} and commit ${commitHash}`);
